Transition_provenance_precedent$gravity = -1
ProvenancesData1 = ProvenancesData[which(ProvenancesData$flag==1),-c(7)]
for(i in 1:nrow(ProvenancesData1)){
value = ProvenancesData1[i,'precedent']
colN = names(ProvenancesData1[i,-c(1)])[(max.col(ProvenancesData1[i,-c(1)]))]
valN = paste(ProvenancesData1[i,colN],"%")
Transition_provenance_precedent[i,'description']=paste("Plus de",ProvenancesData1[i,colN],"% des parties lues avant cette partie se situent beaucoup plus an arrière dans la structure du cours. L'arrivée depuis la partie qui précède celle-ci ne représente que",value,"% des arrivées")
}
Transition_provenance_precedent$suggestion_title="Revoir la structure du cours"
Transition_provenance_precedent$suggestion_content=""
# parties antérieures
ProvenancesData = Provenances_stats[,-c(7)]
for(i in 1:nrow(ProvenancesData)){
somme=sum(ProvenancesData[i,-c(1)])
if(somme> 0) ProvenancesData[i,-c(1)] = round(ProvenancesData[i,-c(1)]*100/somme,0)
}
ProvenancesData$total_next = ProvenancesData$next_p+ProvenancesData$shifted_next
Transition_provenance_totalnext = ProvenancesData[which(ProvenancesData$total_next>30),c('part_index','total_next')]
Transition_provenance_totalnext$classe="Transition"
Transition_provenance_totalnext$issueCode="TransProvF"
Transition_provenance_totalnext$content="Beaucoup d\'arrivées depuis des parties plus en avant"
Transition_provenance_totalnext$description=paste('Dans',Transition_provenance_totalnext$total_next,"% des cas, la partie lue avant celle-ci se situe plus en avant dans la structure du cours. Ce sont souvent des retours en arrière")
Transition_provenance_totalnext$norm_value=''
Transition_provenance_totalnext$gravity = -1
Transition_provenance_totalnext$suggestion_title="Revoir la structure du cours"
Transition_provenance_totalnext$suggestion_content=""
# partie suivante
DestinationsData = Destinations_stats[,-c(7)]
for(i in 1:nrow(DestinationsData)){
somme=sum(DestinationsData[i,-c(1)])
if(somme> 0)DestinationsData[i,-c(1)] = round(DestinationsData[i,-c(1)]*100/somme,0)
}
DestinationsData$flag=0
for(i in 1:nrow(DestinationsData)){
maxV = max(DestinationsData[i,-c(1)])
if(DestinationsData[i,"next_p"]<maxV)
DestinationsData[i,"flag"] = 1
}
Transition_Destination_precedent = DestinationsData[which(DestinationsData$flag==1),c('part_index','next_p')]
Transition_Destination_precedent$classe="Transition"
Transition_Destination_precedent$issueCode="TransDestAutre"
Transition_Destination_precedent$content="Beaucoup de départs vers des partie autre que celle qui suit"
Transition_Destination_precedent$norm_value=" "
Transition_Destination_precedent$gravity = -1
DestinationsData1 = DestinationsData[which(DestinationsData$flag==1),-c(7)]
for(i in 1:nrow(DestinationsData1)){
value = DestinationsData1[i,'next_p']
colN = names(DestinationsData1[i,-c(1)])[(max.col(DestinationsData1[i,-c(1)]))]
valN = paste(DestinationsData1[i,colN],"%")
Transition_Destination_precedent[i,'description']=paste("Dans",(100-value),"% des cas, la partie lue après celle-ci n'est pas celle qui la suit dans la structure du cours. Cette dernière ne représente que",value,"% des cas")
}
Transition_Destination_precedent$suggestion_title="Revoir la structure du cours"
Transition_Destination_precedent$suggestion_content=""
# Retour en arrière
DestinationsData = Destinations_stats[,-c(7)]
for(i in 1:nrow(DestinationsData)){
somme=sum(DestinationsData[i,-c(1)])
if(somme> 0) DestinationsData[i,-c(1)] = round(DestinationsData[i,-c(1)]*100/somme,0)
}
DestinationsData$total_back = DestinationsData$precedent+DestinationsData$shifted_past
Transition_Destination_totalback = DestinationsData[which(DestinationsData$total_back>30),c('part_index','total_back')]
Transition_Destination_totalback$classe="Transition"
Transition_Destination_totalback$issueCode="TransDestPast"
Transition_Destination_totalback$content="Beaucoup de sauts de parties après celle-ci"
Transition_Destination_totalback$description=paste("Dans",Transition_Destination_totalback$total_back,"% des cas, la partie lue après celle-ci se situe très en avant")
Transition_Destination_totalback$norm_value=" "
Transition_Destination_totalback$gravity = -1
Transition_Destination_totalback$suggestion_title="Revoir la structure du cours"
Transition_Destination_totalback$suggestion_content=""
medianR = round(100* median(Ruptures$rupture)/sum(Ruptures$rupture),2)
Stop_stop_max = Ruptures[which(Ruptures$rupture>quantile(Ruptures$rupture,0.9,na.rm = TRUE)),c('part_index','rupture')]
Stop_stop_max$rupture=round(Stop_stop_max$rupture * 100 / sum(Ruptures$rupture),1)
Stop_stop_max$classe="Stop"
Stop_stop_max$issueCode="StopRSEnd"
Stop_stop_max$content=paste( "Nombre de fins de séances important")
Stop_stop_max$description=paste(Stop_stop_max$rupture, "% de fins de séances de lecture se passent sur cette partie. La valeur médian pour les autres parties est de",medianR,"%")
Stop_stop_max$norm_value=" "
Stop_stop_max$gravity = -1
Stop_stop_max$suggestion_title="Revoir la partie et la structuration"
Stop_stop_max$suggestion_content=""
medianR = round(100* median(Ruptures$norecovery)/sum(Ruptures$norecovery),2)
Stop_final_stop = Ruptures[which(Ruptures$norecovery>quantile(Ruptures$norecovery,0.8,na.rm = TRUE)),c('part_index','norecovery')]
Stop_final_stop$norecovery=round(Stop_final_stop$norecovery * 100 / sum(Ruptures$norecovery),1)
Stop_final_stop$classe="Stop"
Stop_final_stop$issueCode="StopRSExit"
Stop_final_stop$content=paste("Taux important d'abandon définitif de la lecture  sur la partie")
Stop_final_stop$description=paste(Stop_final_stop$norecovery, "des fins définitives de la lecture  (sans reprises ultérieures) se passent sur cette partie. La valeur médiane des arrêts définitifs sur les autres parties est de",medianR,"%")
Stop_final_stop$norm_value=" "
Stop_final_stop$gravity = -1
Stop_final_stop$suggestion_title="Revoir la partie et la structuration"
Stop_final_stop$suggestion_content=""
# RUPTURES AVEC REPRISES SUR LE PROCHAIN PART
Stop_next_recovery = Ruptures[which(Ruptures$next_recovery<quantile(Ruptures$next_recovery,0.3,na.rm = TRUE)),c('part_index','next_recovery')]
Stop_next_recovery$next_recovery=paste(round(Stop_next_recovery$next_recovery * 100 / sum(Ruptures$next_recovery),0)," %")
Stop_next_recovery$classe="Stop"
Stop_next_recovery$issueCode="StopRecNext"
Stop_next_recovery$content=paste("Peu de reprise sur la partie qui suit")
Stop_next_recovery$description=paste("Uniquement",Stop_next_recovery$next_recovery, "des reprises de la lecture sont faites sur la partie qui suit celle-ci")
Stop_next_recovery$norm_value=" "
Stop_next_recovery$gravity = -1
Stop_next_recovery$suggestion_title="Revoir la partie et la structuration"
Stop_next_recovery$suggestion_content=""
# RUPTURES BACK
Stop_back_recovery = Ruptures[which(Ruptures$back_recovery>quantile(Ruptures$back_recovery,0.7,na.rm = TRUE)),c('part_index','back_recovery')]
Stop_back_recovery$back_recovery=round(Stop_back_recovery$back_recovery * 100 / sum(Ruptures$back_recovery),1)
Stop_back_recovery$classe="Stop"
Stop_back_recovery$issueCode="StopRecback"
Stop_back_recovery$content="Beaucoup de reprise de la lecture avec retour en arrière"
Stop_back_recovery$description=paste("Lors de la reprise de la lecture après une fin sur cette partie,",Stop_back_recovery$back_recovery, "% des reprises se font sur une partie en arrière")
Stop_back_recovery$norm_value=" "
Stop_back_recovery$gravity = -1
Stop_back_recovery$suggestion_title="Revoir la partie et la structuration"
Stop_back_recovery$suggestion_content=""
# RUPTURES SHIFTED
Stop_shifted_recovery = Ruptures[which(Ruptures$shifted_recovery>quantile(Ruptures$shifted_recovery,0.8,na.rm = TRUE)),c('part_index','shifted_recovery')]
Stop_shifted_recovery$shifted_recovery=round(Stop_shifted_recovery$shifted_recovery * 100 / sum(Ruptures$shifted_recovery),0)
Stop_shifted_recovery$classe="Stop"
Stop_shifted_recovery$issueCode="StopRecShift"
Stop_shifted_recovery$content="Beaucoup de reprise de la lecture avec saut en avant"
Stop_shifted_recovery$description=paste("Lors de la reprise de la lecture après une fin sur cette partie,",Stop_shifted_recovery$shifted_recovery, "% des cas se font par un saut important en avant")
Stop_shifted_recovery$norm_value=" "
Stop_shifted_recovery$gravity = -1
Stop_shifted_recovery$suggestion_title="Revoir la partie et la structuration"
Stop_shifted_recovery$suggestion_content=""
names(Interest_nbvisites_vmin)[c(1,2)]
names(Interest_nbvisites_max)[c(1,2)]
structure
Interest
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(6,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_vmin$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_min = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.25,na.rm = TRUE) &
Interest$Actions_nb>quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_min$classe="Readings"
Interest_nbvisites_min$issueCode="RminVisit"
Interest_nbvisites_min$content="Très peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_min$Actions_nb,2)
Interest_nbvisites_min$description=paste("Cette partie est visitée", val," fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_min$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_min$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_min$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_min$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_min$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_vmax = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_vmax$classe="Readings"
Interest_nbvisites_vmax$issueCode="RVmaxVisit"
Interest_nbvisites_vmax$content="Enormément de visites"
val = round(Interest_nbvisites_vmax$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),2)
Interest_nbvisites_vmax$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmax$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmax$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmax$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmax$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_vmax$suggestion_content=""
Interest_nbvisites_max = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.75,na.rm = TRUE) &
Interest$Actions_nb<quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_max$classe="Readings"
Interest_nbvisites_max$issueCode="RmaxVisit"
Interest_nbvisites_max$content="Beaucoup de visites"
val = round(Interest_nbvisites_max$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_max$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_max$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_max$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_max$suggestion_content=""
names(Interest_nbvisites_min)[c(1,2)]
names(Interest_nbvisites_vmin)[c(1,2)]
####### NOMBRE DE VISITES
Interest = merge(Interest, structure[,c(1,2)])
Interest$Actions_nb=as.numeric(Interest$Actions_nb)
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(6,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_vmin$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_min = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.25,na.rm = TRUE) &
Interest$Actions_nb>quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(6,2)]
Interest_nbvisites_min$classe="Readings"
Interest_nbvisites_min$issueCode="RminVisit"
Interest_nbvisites_min$content="Très peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_min$Actions_nb,2)
Interest_nbvisites_min$description=paste("Cette partie est visitée", val," fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_min$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_min$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_min$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_min$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_min$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_vmax = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(6,2)]
Interest_nbvisites_vmax$classe="Readings"
Interest_nbvisites_vmax$issueCode="RVmaxVisit"
Interest_nbvisites_vmax$content="Enormément de visites"
val = round(Interest_nbvisites_vmax$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),2)
Interest_nbvisites_vmax$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmax$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmax$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmax$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmax$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_vmax$suggestion_content=""
Interest_nbvisites_max = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.75,na.rm = TRUE) &
Interest$Actions_nb<quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(6,2)]
Interest_nbvisites_max$classe="Readings"
Interest_nbvisites_max$issueCode="RmaxVisit"
Interest_nbvisites_max$content="Beaucoup de visites"
val = round(Interest_nbvisites_max$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_max$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_max$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_max$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_max$suggestion_content=""
Interest = eval(parse(text = paste(selectedCourse,"Interest",sep=".")))
Interest = merge(Interest, structure[,c(1,2)])
names(Interest)
Interest = Interest[,c(6,1,2,3,4,5)]
names(Interest)
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_vmin$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_min = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.25,na.rm = TRUE) &
Interest$Actions_nb>quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_min$classe="Readings"
Interest_nbvisites_min$issueCode="RminVisit"
Interest_nbvisites_min$content="Très peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_min$Actions_nb,2)
Interest_nbvisites_min$description=paste("Cette partie est visitée", val," fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_min$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_min$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_min$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_min$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_min$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_vmax = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_vmax$classe="Readings"
Interest_nbvisites_vmax$issueCode="RVmaxVisit"
Interest_nbvisites_vmax$content="Enormément de visites"
val = round(Interest_nbvisites_vmax$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),2)
Interest_nbvisites_vmax$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmax$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmax$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmax$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmax$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_vmax$suggestion_content=""
Interest_nbvisites_max = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.75,na.rm = TRUE) &
Interest$Actions_nb<quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_max$classe="Readings"
Interest_nbvisites_max$issueCode="RmaxVisit"
Interest_nbvisites_max$content="Beaucoup de visites"
val = round(Interest_nbvisites_max$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_max$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_max$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_max$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_max$suggestion_content=""
Interest = eval(parse(text = paste(selectedCourse,"Interest",sep=".")))
Interest = merge(Interest, structure[,c(1,2)])
Interest = Interest[,c(6,1,2,3,4,5)]
Interest$Actions_nb = as.numeric(Interest$Actions_nb)
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_vmin$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
median(Interest$Actions_nb,na.rm = TRUE)
Interest_nbvisites_vmin$gravity
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin=NULML
Interest_nbvisites_vmin=NULL
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
dif
abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin
val
Interest_nbvisites_vmin$Actions_nb
Interest = eval(parse(text = paste(selectedCourse,"Interest",sep=".")))
Interest = merge(Interest, structure[,c(1,2)])
names(Interest)
Interest = Interest[,c(6,2,3,4,5,1)]
Interest$Actions_nb = as.numeric(Interest$Actions_nb)
Interest_nbvisites_vmin = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_vmin$classe="Readings"
Interest_nbvisites_vmin$issueCode="RVminVisit"
Interest_nbvisites_vmin$content="Trop peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_vmin$Actions_nb,1)
Interest_nbvisites_vmin$description=paste("Cette partie est visitée", val,"fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmin$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmin$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmin$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmin$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_vmin$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_min = Interest[which(Interest$Actions_nb<quantile(Interest$Actions_nb,0.25,na.rm = TRUE) &
Interest$Actions_nb>quantile(Interest$Actions_nb,0.10,na.rm = TRUE)),c(1,2)]
Interest_nbvisites_min$classe="Readings"
Interest_nbvisites_min$issueCode="RminVisit"
Interest_nbvisites_min$content="Très peu de visites"
val = round(round(median(Interest$Actions_nb,na.rm = TRUE),0)/ Interest_nbvisites_min$Actions_nb,2)
Interest_nbvisites_min$description=paste("Cette partie est visitée", val," fois moins que le nombre médian de visites des autres parties.")
Interest_nbvisites_min$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_min$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_min$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_min$suggestion_title="Revoir le titre et le contenu"
Interest_nbvisites_min$suggestion_content="Est-ce que le titre de la partie résume bien son contenu ? Si oui :
Est-ce que ce chapitre/partie est  réellement intéressant par rapport au cours ?
Si cet élément est réellement nécessaire : peut-il être reformulé, voire intégré dans une autre partie du cours ?
Sinon, le supprimer et revoir le plan du chapitre et du cours. Sinon le reformuler"
Interest_nbvisites_vmax = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_vmax$classe="Readings"
Interest_nbvisites_vmax$issueCode="RVmaxVisit"
Interest_nbvisites_vmax$content="Enormément de visites"
val = round(Interest_nbvisites_vmax$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),2)
Interest_nbvisites_vmax$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_vmax$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_vmax$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_vmax$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_vmax$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_vmax$suggestion_content=""
Interest_nbvisites_max = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.75,na.rm = TRUE) &
Interest$Actions_nb<quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_max$classe="Readings"
Interest_nbvisites_max$issueCode="RmaxVisit"
Interest_nbvisites_max$content="Beaucoup de visites"
val = round(Interest_nbvisites_max$Actions_nb/median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$description=paste("Cette partie est visitée", val," fois plus que le nombre médian de visites des autres parties.")
Interest_nbvisites_max$norm_value=round(median(Interest$Actions_nb,na.rm = TRUE),0)
dif = abs(Interest_nbvisites_max$Actions_nb  - median(Interest$Actions_nb,na.rm = TRUE))
Interest_nbvisites_max$gravity=round(5 * dif / median(Interest$Actions_nb,na.rm = TRUE),0)
Interest_nbvisites_max$suggestion_title="Revoir la structure du cours"
Interest_nbvisites_max$suggestion_content=""
names(Interest_nbvisites_vmin)[c(1,2)]=
names(Interest_nbvisites_min)[c(1,2)]=
names(Interest_nbvisites_vmax)[c(1,2)]=
names(Interest_nbvisites_max)[c(1,2)]=
names(Interest_duration_vmin)[c(1,2)]=
names(Interest_duration_min)[c(1,2)]=
names(Interest_duration_max)[c(1,2)]=
names(Rereads_rereadings_vmax)[c(1,2)]=
names(Rereads_rereadings_max)[c(1,2)]=
names(Rereads_rereadings_vmax)[c(1,2)]=
names(Rereads_rereadings_max)[c(1,2)]=
names(Rereads_Decaled_rereadings_vmax)[c(1,2)]=
names(Rereads_Decaled_rereadings_max)[c(1,2)]=
names(Transition_provenance_precedent)[c(1,2)]=
names(Transition_provenance_totalnext)[c(1,2)]=
names(Transition_Destination_precedent)[c(1,2)]=
names(Transition_Destination_totalback)[c(1,2)]=
names(Stop_final_stop)[c(1,2)]=
names(Stop_next_recovery)[c(1,2)]=
names(Stop_back_recovery)[c(1,2)]=
names(Stop_shifted_recovery)[c(1,2)]=c("id","value")
facts =
rbind(
Interest_nbvisites_vmin,
Interest_nbvisites_min,
Interest_nbvisites_vmax,
Interest_nbvisites_max,
Interest_duration_vmin,
Interest_duration_min,
Interest_duration_max,
Rereads_rereadings_vmax,
Rereads_rereadings_max,
Rereads_Decaled_rereadings_vmax,
Rereads_Decaled_rereadings_max,
Transition_provenance_precedent,
Transition_provenance_totalnext,
Transition_Destination_precedent,
Transition_Destination_totalback,
Stop_final_stop,
Stop_next_recovery,
Stop_back_recovery,
Stop_shifted_recovery)
names(facts)[1]="part_index"
facts$part_index=as.numeric(facts$part_index)
save(facts, file="nodejs.facts.rdata")
library('jsonlite')
library('reshape')
names(facts)[1]='id'
facts.json = toJSON(unname(split(facts, 1:nrow(facts))))
cat(facts.json, file="nodejs.facts.json")
PartData = structure
PartData = structure
nParties=nrow(PartData[which(PartData$id<0),])
nParties
nParties=nrow(PartData[which(PartData$id==0),])
nParties
PartData[which(PartData$id<0),]$id=-1*(1:nParties)
PartData[which(PartData$id==0),]$id=-1*(1:nParties)
PartData = structure
nParties=nrow(PartData[which(PartData$id==0),])
PartData[which(PartData$id==0),]$id=-1*(0:(nParties-1)
names(PartData)[c(1,5)]
names(PartData)
names(PartData)[c(1,5)]
names(PartData)[c(1,5)]=c('part_index','subtype')
PartData[which(PartData$subtype=='title-1'),]$subtype='partie'
PartData[which(PartData$subtype=='title-2'),]$subtype='chapitre'
PartData[which(PartData$subtype=='title-3'),]$subtype='section'
Interest[,-c(2)]
PartData = structure
nParties=nrow(PartData[which(PartData$id==0),])
PartData[which(PartData$id==0),]$id=-1*(0:(nParties-1)
PartData
PartData = structure
nParties=nrow(PartData[which(PartData$id==0),])
PartData[which(PartData$id==0),]$id=-1*(0:(nParties-1)
)
PartData
PartData[which(PartData$type=='title-1'),]$subtype='partie'
PartData[which(PartData$type=='title-2'),]$subtype='chapitre'
PartData[which(PartData$type=='title-3'),]$subtype='section'
PartData = structure
nParties=nrow(PartData[which(PartData$id==0),])
PartData[which(PartData$id==0),]$id=-1*(0:(nParties-1))
names(PartData)
PartData$type
PartData[which(PartData$type=='title-1'),]$type='partie'
PartData[which(PartData$type=='title-2'),]$type='chapitre'
PartData[which(PartData$type=='title-3'),]$type='section'
Interest
PartData = merge(PartData, Interest[,-c(3,6)], by= 'id',all.x = TRUE)
names(PartData)[1]='part_index'
names(PartData)[3]='part_parent'
names(PartData)[4]='part_title'
names(PartData)[5]='part_type'
PartData = merge(PartData, Reads,  by = 'part_index',all.x = TRUE)
PartData = merge(PartData, Ruptures[,-c(2)],  by = 'part_index',all.x = TRUE)
names(Provenances_stats)=c("part_index","provenance_precedent","provenance_shifted_past", "provenance_identity","provenance_next_p","provenance_shifted_next","provenance_total_next")
names(Destinations_stats)=c("part_index","destination_precedent","destination_shifted_past", "destination_identity","destination_next_p","destination_shifted_next","destination_total_next")
PartData = merge(PartData, Provenances_stats,  by = 'part_index',all.x = TRUE)
PartData = merge(PartData, Destinations_stats,  by = 'part_index',all.x = TRUE)
save(PartData, file='PartData.rdata')
colnames(PartData)[1]="id"
meltParts=melt(PartData, id.vars = 'id')
PartsData.json = toJSON(unname(split(meltParts,1:nrow(meltParts))))
cat(PartsData.json, file="structure.json")
View(PartData)
Interest_nbvisites_vmax = Interest[which(Interest$Actions_nb>quantile(Interest$Actions_nb,0.9,na.rm = TRUE) ),c(1,2)]
Interest_nbvisites_vmax
quantile(Interest$Actions_nb,0.9,na.rm = TRUE) )
quantile(Interest$Actions_nb,0.9,na.rm = TRUE)
median(Interest$Actions_nb,0.9,na.rm = TRUE)
median(Interest$Actions_nb,na.rm = TRUE)
